<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arduino Code Generator</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        #code-output { white-space: pre-wrap; background-color: #f4f4f4; padding: 10px; border-radius: 5px; }
        select, button { padding: 10px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>Arduino Code Generator</h1>
    
    <label for="template-select">Choose a Template:</label>
    <select id="template-select">
        <option value="">Select Template</option>
    </select>

    <button id="generate-btn">Generate Arduino Code</button>

    <h2>Generated Code:</h2>
    <div id="code-output"></div>

    <script>
        // Load model.json and vocab.json from server
        async function loadModel() {
            try {
                const response = await fetch('model.json');
                const modelData = await response.json();

                // Populate template options based on loaded model data
                const templateSelect = document.getElementById('template-select');
                modelData.templates.forEach(template => {
                    const option = document.createElement('option');
                    option.value = template.name;
                    option.textContent = template.name;
                    templateSelect.appendChild(option);
                });

            } catch (error) {
                console.error('Error loading model.json:', error);
            }
        }

        // Generate Arduino code based on selected template
        function generateArduinoCode(templateName) {
            const templateSelect = document.getElementById('template-select');
            const selectedTemplate = templateSelect.value;

            // Find the selected template from the loaded model data
            fetch('model.json')
                .then(response => response.json())
                .then(modelData => {
                    const template = modelData.templates.find(t => t.name === selectedTemplate);

                    if (template) {
                        let code = '';

                        // Generate setup and loop functions
                        code += `void setup() {\n`;
                        template.functions.forEach(func => {
                            if (func.name === 'setup') {
                                code += `    ${func.body}\n`;
                            }
                        });
                        code += `}\n\n`;

                        code += `void loop() {\n`;
                        template.functions.forEach(func => {
                            if (func.name === 'loop') {
                                code += `    ${func.body}\n`;
                            }
                        });
                        code += `}\n`;

                        // Display generated code in the output div
                        document.getElementById('code-output').textContent = code;
                    }
                })
                .catch(error => console.error('Error generating code:', error));
        }

        // Initialize the page
        window.onload = () => {
            loadModel();

            document.getElementById('generate-btn').addEventListener('click', () => {
                const selectedTemplate = document.getElementById('template-select').value;
                if (selectedTemplate) {
                    generateArduinoCode(selectedTemplate);
                } else {
                    alert('Please select a template.');
                }
            });
        };
    </script>
</body>
</html>
