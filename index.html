<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Code Generator</title>
    <script type="module">
        class AiCodeGenerator extends HTMLElement {
            constructor() {
                super();
                this.attachShadow({ mode: 'open' });
                this.loadModel = this.getAttribute('load-model') === 'true';
                this.viewMode = this.getViewMode();
                this.init();
            }

            // Fungsi untuk mendeteksi mode perangkat (mobile/desktop)
            getViewMode() {
                const isMobile = window.innerWidth <= 768;
                return isMobile ? 'mobile' : 'desktop';
            }

            // Membuat elemen-elemen berdasarkan mode tampilan (mobile/desktop)
            init() {
                this.render();
                window.addEventListener('resize', () => this.onResize());
            }

            onResize() {
                const newViewMode = this.getViewMode();
                if (newViewMode !== this.viewMode) {
                    this.viewMode = newViewMode;
                    this.render();
                }
            }

            render() {
                this.clearContent(); // Hapus konten sebelumnya sebelum render ulang

                if (this.viewMode === 'mobile') {
                    this.createMobileView();
                } else {
                    this.createDesktopView();
                }

                if (this.loadModel) {
                    this.loadModelData();
                }
            }

            async loadModelData() {
                try {
                    const response = await fetch('https://4211421036.github.io/codegenerator/ai_model/model.json');
                    if (!response.ok) throw new Error(`Error ${response.status}`);
                    this.modelData = await response.json();
                } catch (error) {
                    console.error("Failed to load model data:", error);
                    this.createErrorMessage('Failed to load model data.');
                }
            }

            // Menghapus semua elemen di shadow root
            clearContent() {
                this.shadowRoot.innerHTML = '';
            }

            // Membuat elemen untuk tampilan mobile
            createMobileView() {
                const mobileApp = document.createElement('mobile-app');
                mobileApp.setAttribute('text', 'AI Arduino Code Generator');

                const mobileTextArea = document.createElement('mobile-generator-text');
                mobileTextArea.setAttribute('placeholder', 'Describe your Arduino project...');
                mobileTextArea.setAttribute('name', 'project-description');
                mobileTextArea.setAttribute('id', 'textarea-id');

                const mobileButton = document.createElement('mobile-generator-render');
                const mobileOutput = document.createElement('mobile-generator-output');

                const errorMessage = document.createElement('error-message');
                
                this.shadowRoot.appendChild(mobileApp);
                this.shadowRoot.appendChild(mobileTextArea);
                this.shadowRoot.appendChild(mobileButton);
                this.shadowRoot.appendChild(errorMessage);
                this.shadowRoot.appendChild(mobileOutput);

                // Apply floating and flex layout styles
                this.applyMobileStyles();
            }

            // Membuat elemen untuk tampilan desktop
            createDesktopView() {
                const desktopApp = document.createElement('desktop-app');
                desktopApp.setAttribute('text', 'AI Arduino Code Generator');

                const desktopTextArea = document.createElement('desktop-generator-text');
                desktopTextArea.setAttribute('placeholder', 'Describe your Arduino project...');
                desktopTextArea.setAttribute('name', 'project-description');
                desktopTextArea.setAttribute('id', 'textarea-id');

                const desktopButton = document.createElement('desktop-generator-render');
                const desktopOutput = document.createElement('desktop-generator-output');

                const errorMessage = document.createElement('error-message');
                
                this.shadowRoot.appendChild(desktopApp);
                this.shadowRoot.appendChild(desktopTextArea);
                this.shadowRoot.appendChild(desktopButton);
                this.shadowRoot.appendChild(errorMessage);
                this.shadowRoot.appendChild(desktopOutput);
            }

            // Menampilkan pesan error
            createErrorMessage(message) {
                const errorMessage = document.createElement('error-message');
                errorMessage.setAttribute('text', message);
                this.shadowRoot.appendChild(errorMessage);
            }

            // Menambahkan style untuk tampilan mobile yang seperti chat dengan flex layout
            applyMobileStyles() {
                const style = document.createElement('style');
                style.textContent = `
                    :host {
                        display: block;
                        position: relative;
                        height: 100vh;
                    }

                    mobile-app {
                        padding: 10px;
                    }

                    mobile-generator-text {
                        position: fixed;
                        bottom: 70px;
                        left: 10px;
                        right: 10px;
                        width: calc(100% - 20px);
                        padding: 10px;
                        border-radius: 10px;
                        border: 1px solid #ccc;
                        font-size: 14px;
                        background-color: white;
                    }

                    mobile-generator-render {
                        position: fixed;
                        bottom: 10px;
                        left: 10px;
                        right: 10px;
                        display: flex;
                        justify-content: flex-end;
                    }

                    mobile-generator-render button {
                        padding: 10px 20px;
                        font-size: 14px;
                        border-radius: 5px;
                        background-color: #007bff;
                        color: white;
                        border: none;
                    }

                    mobile-generator-output {
                        margin-top: 80px;
                    }
                `;
                this.shadowRoot.appendChild(style);
            }
        }

        class MobileApp extends HTMLElement {
            constructor() {
                super();
                const shadow = this.attachShadow({ mode: 'open' });
                const container = document.createElement('div');
                container.innerHTML = `<h1>${this.getAttribute('text') || 'AI Code Generator'}</h1>`;
                shadow.appendChild(container);
            }
        }

        class MobileGeneratorText extends HTMLElement {
            constructor() {
                super();
                const shadow = this.attachShadow({ mode: 'open' });
                const textarea = document.createElement('textarea');
                textarea.placeholder = this.getAttribute('placeholder') || 'Describe your project...';
                textarea.name = this.getAttribute('name') || 'project-description';
                textarea.id = this.getAttribute('id') || 'textarea-id';
                shadow.appendChild(textarea);
            }
        }

        class MobileGeneratorRender extends HTMLElement {
            constructor() {
                super();
                const shadow = this.attachShadow({ mode: 'open' });
                const button = document.createElement('button');
                button.textContent = 'Generate Code';
                shadow.appendChild(button);
            }
        }

        class MobileGeneratorOutput extends HTMLElement {
            constructor() {
                super();
                const shadow = this.attachShadow({ mode: 'open' });
                const pre = document.createElement('pre');
                pre.textContent = 'Generated code will appear here...';
                shadow.appendChild(pre);
            }
        }

        class DesktopApp extends HTMLElement {
            constructor() {
                super();
                const shadow = this.attachShadow({ mode: 'open' });
                const container = document.createElement('div');
                container.innerHTML = `<h1>${this.getAttribute('text') || 'AI Code Generator'}</h1>`;
                shadow.appendChild(container);
            }
        }

        class DesktopGeneratorText extends HTMLElement {
            constructor() {
                super();
                const shadow = this.attachShadow({ mode: 'open' });
                const textarea = document.createElement('textarea');
                textarea.placeholder = this.getAttribute('placeholder') || 'Describe your project...';
                textarea.name = this.getAttribute('name') || 'project-description';
                textarea.id = this.getAttribute('id') || 'textarea-id';
                shadow.appendChild(textarea);
            }
        }

        class DesktopGeneratorRender extends HTMLElement {
            constructor() {
                super();
                const shadow = this.attachShadow({ mode: 'open' });
                const button = document.createElement('button');
                button.textContent = 'Generate Code';
                shadow.appendChild(button);
            }
        }

        class DesktopGeneratorOutput extends HTMLElement {
            constructor() {
                super();
                const shadow = this.attachShadow({ mode: 'open' });
                const pre = document.createElement('pre');
                pre.textContent = 'Generated code will appear here...';
                shadow.appendChild(pre);
            }
        }

        class ErrorMessage extends HTMLElement {
            static get observedAttributes() {
                return ['text'];
            }

            attributeChangedCallback(name, oldValue, newValue) {
                if (name === 'text') {
                    const shadow = this.shadowRoot || this.attachShadow({ mode: 'open' });
                    const div = document.createElement('div');
                    div.style.color = '#dc3545';
                    div.style.padding = '10px';
                    div.style.border = '1px solid #dc3545';
                    div.style.marginTop = '10px';
                    div.textContent = newValue;
                    shadow.innerHTML = '';
                    shadow.appendChild(div);
                }
            }

            connectedCallback() {
                if (!this.shadowRoot) {
                    this.attachShadow({ mode: 'open' });
                }
            }
        }

        customElements.define('ai-code-generator', AiCodeGenerator);
        customElements.define('mobile-app', MobileApp);
        customElements.define('mobile-generator-text', MobileGeneratorText);
        customElements.define('mobile-generator-render', MobileGeneratorRender);
        customElements.define('mobile-generator-output', MobileGeneratorOutput);
        customElements.define('desktop-app', DesktopApp);
        customElements.define('desktop-generator-text', DesktopGeneratorText);
        customElements.define('desktop-generator-render', DesktopGeneratorRender);
        customElements.define('desktop-generator-output', DesktopGeneratorOutput);
        customElements.define('error-message', ErrorMessage);
    </script>
</head>
<body>
    <ai-code-generator load-model="true"></ai-code-generator>
</body>
</html>
