<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Arduino Code Generator AI</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
</head>
<body>
    <h1>Arduino Code Generator</h1>
    <textarea id="userInput" rows="4" placeholder="Describe your Arduino project..."></textarea>
    <button id="generateButton">Generate Code</button>
    <pre id="outputCode"></pre>

    <script>
        let model, vocab;

        async function loadModelAndVocab() {
            try {
                model = await tf.loadLayersModel('path/to/model.json');
                const response = await fetch('path/to/vocab.json');
                vocab = await response.json();
            } catch (error) {
                console.error("Model loading failed:", error);
            }
        }

        function prepareInput(text) {
            // Tokenize input, preserve structure
            return text.toLowerCase()
                .split(/\s+/)
                .filter(token => token.length > 0)
                .slice(0, 100);
        }

        function decodeOutput(outputTensor) {
            const outputIndices = Array.from(outputTensor.argMax(-1).dataSync());
            const tokens = outputIndices
                .map(index => vocab.vocabulary[index] || '')
                .filter(token => token !== '');

            // Reconstruct code with basic Arduino template
            const reconstructedCode = [
                "void setup() {",
                "  // Setup code based on your description",
                "}",
                "",
                "void loop() {",
                "  // Generated loop logic",
                "}"
            ];

            return tokens.join(' ');
        }

        async function generateCode() {
            const input = document.getElementById('userInput').value;
            const processedInput = prepareInput(input);
            const inputTensor = tf.tensor2d([processedInput], [1, 100]);

            try {
                const prediction = model.predict(inputTensor);
                const generatedCode = decodeOutput(prediction);
                
                document.getElementById('outputCode').textContent = generatedCode;
            } catch (error) {
                console.error("Code generation failed:", error);
            }
        }

        document.getElementById('generateButton').addEventListener('click', generateCode);
        window.onload = loadModelAndVocab;
    </script>
</body>
</html>
