<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Code Generator</title>
    <script type="module">
        class AiCodeGenerator extends HTMLElement {
            constructor() {
                super();
                this.attachShadow({ mode: 'open' });
                this.viewMode = this.getAttribute('view-mode') || 'desktop';
                this.loadModel = this.getAttribute('load-model') === 'true';
                this.initTemplate();
            }

            connectedCallback() {
                if (this.loadModel) {
                    this.loadModelData();
                }
            }

            async loadModelData() {
                try {
                    const response = await fetch('https://4211421036.github.io/codegenerator/ai_model/model.json');
                    if (!response.ok) throw new Error(`Error ${response.status}`);
                    this.modelData = await response.json();
                } catch (error) {
                    console.error("Failed to load model data:", error);
                    this.shadowRoot.querySelector('error-message').setAttribute('text', 'Failed to load model data.');
                }
            }

            initTemplate() {
                const themeColor = window.matchMedia('(prefers-color-scheme: dark)').matches ? '#1e1e1e' : '#f9f9f9';
                const textColor = window.matchMedia('(prefers-color-scheme: dark)').matches ? '#ffffff' : '#333';
                const template = `
                    <style>
                        :host {
                            display: block;
                            font-family: Arial, sans-serif;
                            background-color: ${themeColor};
                            color: ${textColor};
                            padding: 10px;
                        }
                        :host([view-mode="mobile"]) .desktop-view {
                            display: none;
                        }
                        :host([view-mode="desktop"]) .mobile-view {
                            display: none;
                        }
                    </style>
                    <div class="mobile-view">
                        <mobile-app text="AI Arduino Code Generator"></mobile-app>
                        <mobile-generator-text placeholder="Describe your Arduino project..."></mobile-generator-text>
                        <mobile-generator-render></mobile-generator-render>
                        <error-message></error-message>
                        <mobile-generator-output></mobile-generator-output>
                    </div>
                    <div class="desktop-view">
                        <desktop-app text="AI Arduino Code Generator"></desktop-app>
                        <desktop-generator-text placeholder="Describe your Arduino project..."></desktop-generator-text>
                        <desktop-generator-render></desktop-generator-render>
                        <error-message></error-message>
                        <desktop-generator-output></desktop-generator-output>
                    </div>
                `;
                this.shadowRoot.innerHTML = template;
            }
        }

        class MobileApp extends HTMLElement {
            connectedCallback() {
                this.text = this.getAttribute('text') || 'App';
                this.innerHTML = `<h1>${this.text}</h1>`;
            }
        }

        class MobileGeneratorText extends HTMLElement {
            connectedCallback() {
                this.placeholder = this.getAttribute('placeholder') || 'Input text...';
                this.innerHTML = `<textarea placeholder="${this.placeholder}" style="width: 100%; height: 120px; padding: 10px;"></textarea>`;
            }
        }

        class MobileGeneratorRender extends HTMLElement {
            connectedCallback() {
                this.innerHTML = `<button style="padding: 10px 20px; background-color: #007bff; color: white;">Generate Code</button>`;
            }
        }

        class MobileGeneratorOutput extends HTMLElement {
            connectedCallback() {
                this.innerHTML = `<pre style="background: #272822; color: #f8f8f2; padding: 20px;">Generated code will appear here...</pre>`;
            }
        }

        class DesktopApp extends HTMLElement {
            connectedCallback() {
                this.text = this.getAttribute('text') || 'App';
                this.innerHTML = `<h1>${this.text}</h1>`;
            }
        }

        class DesktopGeneratorText extends HTMLElement {
            connectedCallback() {
                this.placeholder = this.getAttribute('placeholder') || 'Input text...';
                this.innerHTML = `<textarea placeholder="${this.placeholder}" style="width: 100%; height: 120px; padding: 10px;"></textarea>`;
            }
        }

        class DesktopGeneratorRender extends HTMLElement {
            connectedCallback() {
                this.innerHTML = `<button style="padding: 10px 20px; background-color: #007bff; color: white;">Generate Code</button>`;
            }
        }

        class DesktopGeneratorOutput extends HTMLElement {
            connectedCallback() {
                this.innerHTML = `<pre style="background: #272822; color: #f8f8f2; padding: 20px;">Generated code will appear here...</pre>`;
            }
        }

        class ErrorMessage extends HTMLElement {
            static get observedAttributes() {
                return ['text'];
            }

            attributeChangedCallback(name, oldValue, newValue) {
                if (name === 'text') {
                    this.innerHTML = `<div style="color: #dc3545; padding: 10px; border: 1px solid #dc3545; margin-top: 10px;">${newValue}</div>`;
                }
            }
        }

        customElements.define('ai-code-generator', AiCodeGenerator);
        customElements.define('mobile-app', MobileApp);
        customElements.define('mobile-generator-text', MobileGeneratorText);
        customElements.define('mobile-generator-render', MobileGeneratorRender);
        customElements.define('mobile-generator-output', MobileGeneratorOutput);
        customElements.define('desktop-app', DesktopApp);
        customElements.define('desktop-generator-text', DesktopGeneratorText);
        customElements.define('desktop-generator-render', DesktopGeneratorRender);
        customElements.define('desktop-generator-output', DesktopGeneratorOutput);
        customElements.define('error-message', ErrorMessage);
    </script>
</head>
<body>
    <ai-code-generator view-mode="desktop" load-model="true"></ai-code-generator>
</body>
</html>
