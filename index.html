<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Code Generator</title>
    <script type="module">
        class AiCodeGenerator extends HTMLElement {
            constructor() {
                super();
                this.attachShadow({ mode: 'open' });
                this.viewMode = 'desktop'; // default mode
                this.checkDeviceType();
                this.loadModel = this.getAttribute('load-model') === 'true';
                this.initTemplate();
            }

            // Deteksi perangkat dan sesuaikan view mode
            checkDeviceType() {
                const isMobile = window.innerWidth <= 768;
                this.viewMode = isMobile ? 'mobile' : 'desktop';
            }

            connectedCallback() {
                if (this.loadModel) {
                    this.loadModelData();
                }
            }

            async loadModelData() {
                try {
                    const response = await fetch('https://4211421036.github.io/codegenerator/ai_model/model.json');
                    if (!response.ok) throw new Error(`Error ${response.status}`);
                    this.modelData = await response.json();
                } catch (error) {
                    console.error("Failed to load model data:", error);
                    this.shadowRoot.querySelector('error-message').setAttribute('text', 'Failed to load model data.');
                }
            }

            initTemplate() {
                const themeColor = window.matchMedia('(prefers-color-scheme: dark)').matches ? '#1e1e1e' : '#f9f9f9';
                const textColor = window.matchMedia('(prefers-color-scheme: dark)').matches ? '#ffffff' : '#333';
                const template = document.createElement('template');
                
                template.innerHTML = `
                    <style>
                        :host {
                            display: block;
                            font-family: Arial, sans-serif;
                            background-color: ${themeColor};
                            color: ${textColor};
                            padding: 20px;
                        }
                        :host([view-mode="mobile"]) .desktop-view {
                            display: none;
                        }
                        :host([view-mode="desktop"]) .mobile-view {
                            display: none;
                        }
                        .mobile-view, .desktop-view {
                            display: flex;
                            flex-direction: column;
                            align-items: center;
                            justify-content: flex-start;
                            width: 100%;
                        }
                        .mobile-view textarea, .desktop-view textarea {
                            width: 90%;
                            height: 120px;
                            padding: 10px;
                            margin: 10px 0;
                            border: 1px solid #ccc;
                            border-radius: 5px;
                        }
                        .mobile-view button, .desktop-view button {
                            padding: 10px 20px;
                            background-color: #007bff;
                            color: white;
                            border: none;
                            border-radius: 5px;
                            cursor: pointer;
                            margin: 10px 0;
                        }
                        .mobile-view pre, .desktop-view pre {
                            background: #272822;
                            color: #f8f8f2;
                            padding: 20px;
                            width: 90%;
                            overflow-x: auto;
                            border-radius: 5px;
                        }
                        @media (max-width: 768px) {
                            .mobile-view textarea {
                                width: 100%;
                            }
                        }
                    </style>
                    <div class="mobile-view">
                        <mobile-app text="AI Arduino Code Generator"></mobile-app>
                        <mobile-generator-text placeholder="Describe your Arduino project..." name="project-description"></mobile-generator-text>
                        <mobile-generator-render></mobile-generator-render>
                        <error-message></error-message>
                        <mobile-generator-output></mobile-generator-output>
                    </div>
                    <div class="desktop-view">
                        <desktop-app text="AI Arduino Code Generator"></desktop-app>
                        <desktop-generator-text placeholder="Describe your Arduino project..." name="project-description"></desktop-generator-text>
                        <desktop-generator-render></desktop-generator-render>
                        <error-message></error-message>
                        <desktop-generator-output></desktop-generator-output>
                    </div>
                `;
                this.shadowRoot.appendChild(template.content.cloneNode(true));
            }
        }

        class MobileApp extends HTMLElement {
            constructor() {
                super();
                const shadow = this.attachShadow({ mode: 'open' });
                const container = document.createElement('div');
                container.innerHTML = `<h1>${this.getAttribute('text') || 'AI Code Generator'}</h1>`;
                shadow.appendChild(container);
            }
        }

        class MobileGeneratorText extends HTMLElement {
            constructor() {
                super();
                const shadow = this.attachShadow({ mode: 'open' });
                const textarea = document.createElement('textarea');
                textarea.placeholder = this.getAttribute('placeholder') || 'Describe your project...';
                textarea.name = this.getAttribute('name') || 'project-description';
                textarea.id = this.getAttribute('id') || 'textarea-id';
                shadow.appendChild(textarea);
            }
        }

        class MobileGeneratorRender extends HTMLElement {
            constructor() {
                super();
                const shadow = this.attachShadow({ mode: 'open' });
                const button = document.createElement('button');
                button.textContent = 'Generate Code';
                shadow.appendChild(button);
            }
        }

        class MobileGeneratorOutput extends HTMLElement {
            constructor() {
                super();
                const shadow = this.attachShadow({ mode: 'open' });
                const pre = document.createElement('pre');
                pre.textContent = 'Generated code will appear here...';
                shadow.appendChild(pre);
            }
        }

        class DesktopApp extends HTMLElement {
            constructor() {
                super();
                const shadow = this.attachShadow({ mode: 'open' });
                const container = document.createElement('div');
                container.innerHTML = `<h1>${this.getAttribute('text') || 'AI Code Generator'}</h1>`;
                shadow.appendChild(container);
            }
        }

        class DesktopGeneratorText extends HTMLElement {
            constructor() {
                super();
                const shadow = this.attachShadow({ mode: 'open' });
                const textarea = document.createElement('textarea');
                textarea.placeholder = this.getAttribute('placeholder') || 'Describe your project...';
                textarea.name = this.getAttribute('name') || 'project-description';
                textarea.id = this.getAttribute('id') || 'textarea-id';
                shadow.appendChild(textarea);
            }
        }

        class DesktopGeneratorRender extends HTMLElement {
            constructor() {
                super();
                const shadow = this.attachShadow({ mode: 'open' });
                const button = document.createElement('button');
                button.textContent = 'Generate Code';
                shadow.appendChild(button);
            }
        }

        class DesktopGeneratorOutput extends HTMLElement {
            constructor() {
                super();
                const shadow = this.attachShadow({ mode: 'open' });
                const pre = document.createElement('pre');
                pre.textContent = 'Generated code will appear here...';
                shadow.appendChild(pre);
            }
        }

        class ErrorMessage extends HTMLElement {
            static get observedAttributes() {
                return ['text'];
            }

            attributeChangedCallback(name, oldValue, newValue) {
                if (name === 'text') {
                    const shadow = this.shadowRoot || this.attachShadow({ mode: 'open' });
                    const div = document.createElement('div');
                    div.style.color = '#dc3545';
                    div.style.padding = '10px';
                    div.style.border = '1px solid #dc3545';
                    div.style.marginTop = '10px';
                    div.textContent = newValue;
                    shadow.innerHTML = '';
                    shadow.appendChild(div);
                }
            }

            connectedCallback() {
                if (!this.shadowRoot) {
                    this.attachShadow({ mode: 'open' });
                }
            }
        }

        customElements.define('ai-code-generator', AiCodeGenerator);
        customElements.define('mobile-app', MobileApp);
        customElements.define('mobile-generator-text', MobileGeneratorText);
        customElements.define('mobile-generator-render', MobileGeneratorRender);
        customElements.define('mobile-generator-output', MobileGeneratorOutput);
        customElements.define('desktop-app', DesktopApp);
        customElements.define('desktop-generator-text', DesktopGeneratorText);
        customElements.define('desktop-generator-render', DesktopGeneratorRender);
        customElements.define('desktop-generator-output', DesktopGeneratorOutput);
        customElements.define('error-message', ErrorMessage);
    </script>
</head>
<body>
    <ai-code-generator load-model="true"></ai-code-generator>
</body>
</html>
