<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Generator</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@2.10.0"></script> <!-- TensorFlow.js -->
</head>
<body>
    <h1>Arduino Code Generator</h1>
    <p>Masukkan input yang diperlukan untuk menghasilkan kode Arduino (.ino):</p>

    <form id="codeForm">
        <label for="inputText">Deskripsi kode:</label>
        <textarea id="inputText" rows="5" cols="50" placeholder="Masukkan deskripsi atau permintaan untuk kode Arduino"></textarea><br><br>
        <button type="submit">Generate Kode</button>
    </form>

    <h2>Output Kode Arduino (.ino)</h2>
    <pre id="outputCode"></pre>

    <script>
        let model;

        // Fungsi untuk memuat model yang telah dilatih
        async function loadModel() {
            try {
                // Ganti dengan path ke model Anda (URL atau lokal)
                model = await tf.loadLayersModel('model/model.json');
                console.log('Model Loaded');
            } catch (error) {
                console.error("Model failed to load", error);
            }
        }

        // Fungsi untuk menghasilkan kode berdasarkan input
        async function generateCode(inputText) {
            if (!model) {
                console.error('Model belum dimuat!');
                return;
            }

            // Tokenize dan pre-process input (seperti yang telah Anda lakukan di script sebelumnya)
            const tokenizedInput = tokenizeInput(inputText);
            const inputTensor = tf.tensor2d([tokenizedInput], [1, 50]);

            // Prediksi menggunakan model
            const prediction = model.predict(inputTensor);
            const outputTokens = prediction.argMax(-1).dataSync();  // Ambil token yang diprediksi
            const generatedCode = decodeOutput(outputTokens);

            return generatedCode;
        }

        // Tokenisasi input (sesuaikan dengan tokenisasi yang digunakan saat pelatihan)
        function tokenizeInput(text) {
            // Proses tokenisasi sederhana, sesuaikan dengan model Anda
            const tokens = text.split(/\s+/).map((_, i) => i);  // Simplified tokenization
            return tokens.slice(0, 50).concat(Array(50 - tokens.length).fill(0));  // Pad to 50 tokens
        }

        // Decode output menjadi kode .ino
        function decodeOutput(outputTokens) {
            // Mengubah token kembali ke teks atau kode sesuai dengan model Anda
            return outputTokens.join(' ');  // Simpan sebagai string, Anda bisa mengganti ini dengan proses lain
        }

        // Event listener untuk form
        document.getElementById('codeForm').addEventListener('submit', async (event) => {
            event.preventDefault();
            const inputText = document.getElementById('inputText').value;
            const outputCode = await generateCode(inputText);

            // Tampilkan kode yang dihasilkan di layar
            document.getElementById('outputCode').textContent = outputCode;
        });

        // Memuat model saat halaman dimuat
        loadModel();
    </script>
</body>
</html>
