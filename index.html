<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Arduino Code Generator</title>
  <script type="module" src="./index.mjs"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background-color: #f4f4f9;
    }
    textarea {
      width: 100%;
      height: 100px;
      font-size: 16px;
      padding: 10px;
      margin-bottom: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    button {
      padding: 10px 15px;
      font-size: 16px;
      border: none;
      background-color: #28a745;
      color: white;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background-color: #218838;
    }
    pre {
      background: #eee;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <h1>Arduino Code Generator</h1>
  <p>Masukkan deskripsi proyek Anda di bawah:</p>
  <textarea id="userInput" placeholder="Contoh: Gunakan sensor DHT11 untuk membaca suhu dan menampilkan di Serial Monitor"></textarea>
  <button id="generateButton">Generate Code</button>
  <h2>Hasil Kode Arduino:</h2>
  <pre id="outputCode">Kode akan muncul di sini...</pre>
  <script>
        import * as tf from 'https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.6.0/dist/tf.min.js';
        let model;
        let vocab;
        
        // Memuat model dan vocab saat aplikasi dimulai
        async function loadModel() {
          model = await tf.loadLayersModel('./model/model.json');
          const response = await fetch('./model/vocab.json');
          vocab = await response.json();
          console.log('Model dan kosakata berhasil dimuat.');
        }
        
        // Mengonversi teks input ke token
        function tokenizeInput(inputText) {
          const tokens = inputText.split(' ').map(word => vocab[word] || vocab['<UNK>']);
          return tf.tensor([tokens], [1, tokens.length]);
        }
        
        // Menghasilkan kode dari token
        function detokenizeOutput(tokens) {
          const reverseVocab = Object.fromEntries(Object.entries(vocab).map(([k, v]) => [v, k]));
          return tokens.map(token => reverseVocab[token] || '').join(' ');
        }
        
        // Fungsi utama untuk menghasilkan kode Arduino
        async function generateCode() {
          const input = document.getElementById('userInput').value.trim();
          const outputField = document.getElementById('outputCode');
        
          if (!input) {
            outputField.textContent = 'Harap masukkan deskripsi proyek terlebih dahulu.';
            return;
          }
        
          // Tokenisasi input
          const inputTensor = tokenizeInput(input);
        
          // Prediksi output
          const prediction = model.predict(inputTensor);
          const outputTokens = prediction.argMax(-1).dataSync(); // Ambil token output
        
          // Detokenisasi hasil prediksi
          const outputCode = detokenizeOutput(Array.from(outputTokens));
        
          // Tampilkan kode hasil
          outputField.textContent = outputCode;
        
          // Membersihkan tensor untuk menghindari memory leak
          tf.dispose([inputTensor, prediction]);
        }
        
        // Event listener untuk tombol Generate
        document.getElementById('generateButton').addEventListener('click', generateCode);
        
        // Panggil fungsi loadModel saat aplikasi dimuat
        loadModel();

  </script>
</body>
</html>
